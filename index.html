<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const sun = {
            x: canvas.width/2,
            y: canvas.height/2,
            mass: 100000
        }
        const bodies = 6;
        let bodyList = [];

        //function Body(mass) {

        //}


        class Body {
            constructor(name, x, y, mass, direction, velocity) {
                this.name = name;
                this.x = x;
                this.y = y;
                this.mass = mass;
                this.direction = direction;
                this.velocity = velocity;
            /*
            this.name = 'Body';
            this.x = Math.round(Math.random()*canvas.width);
            this.y = Math.round(Math.random()*canvas.height);
            this.mass = mass;
            this.direction = Math.random()*360;
            this.velocity - Math.random()*15;
            */
            this.vx = lengthDirX(this.velocity,this.direction);
            this.vy = lengthDirY(this.velocity,this.direction);
            //this.ctx = ctx;
            return this;
            }
            //ctx = ctx;
            
            move() {
                //cycle through all other bodies here
                //for (i=0; i<bodies; i++) {
                    //do nothing
                //}
                //console.log(`${this.name}`);
                bodyList.map((i) => {
                    //do nothing
                    //console.log(`${this.name} vs ${i.name}`)
                    if (i != this) {
                        //do nothing
                        //console.log(`${i.name}`)
                        //f = calculatePull(this,i);
                        f = calculatePull2(this.x, this.y ,i.x , i.y, this.mass, i.mass);
                        d = getDirectionDeg(this.x,this.y,i.x,i.y);
                        this.vx += lengthDirX(f,d);
                        this.vy += lengthDirY(f,d);
                    }
                })
/*
                
                for (i=0; i<bodies; i++) {
                    //
                    if (bodyList[i] != this){
                        console.log(`I am ${this}, ${i} is not me!`);
                        let f = calculatePull(this,bodyList[i]);
                        //console.log(f);
                        let d = getDirectionDeg(this.x,this.y,bodyList[i].x,bodyList[i].y);
                        //console.log(d);
            
                        this.vx += lengthDirX(f,d);
                        this.vy += lengthDirY(f,d);
                        //console.log(`vx: ${this.vx}, vy: ${this.vy}`)
                    }
                }
                */
                //f = calculatePull(this,sun);
                //d = getDirectionDeg(this.x,this.y,sun.x,sun.y);
            
                //this.vx += lengthDirX(f,d);
                //this.vy += lengthDirY(f,d);

                this.x += this.vx;
                this.y += this.vy;
                //console.log(`Body with mass: ${this.mass} moved to x: ${this.vx}, y: ${this.vy}`)
                //console.log(this.x);
            }

            draw() {

                

                ctx.strokeStyle = "#000000";
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.mass/20, 0, Math.PI * 2, true); // body
                ctx.stroke();

                ctx.moveTo(this.x, this.y);
                ctx.lineTo(this.x + (this.vx), this.y + (this.vy)); // course
                ctx.stroke();

                ctx.font = "48px serif";
                ctx.fillText(`mass: ${this.mass}`, this.x + 25, this.y + 25);
                ctx.fillText(`name: ${this.name}`, this.x + 25, this.y + 75);
                //console.log(`Draw body with mass ${this.mass} at x: ${this.x}, y: ${this.y}`)
                //console.log(this.name);
                //ctx.fillRect(10, 10, 10 + this.mass, 10 + this.mass);
            }
        }

        //const body = new Body();

        
        /*
        const body = {
            x: Math.random()*canvas.width,
            y: Math.random()*canvas.height,
            mass: 15,
            direction: Math.random()*360,
            velocity: Math.random()*15,
            vx: lengthDirX(2,0),
            vy: lengthDirY(2,0)
        }
*/


        for (i=0; i<bodies; i++) {
            //bodyList[i] = new Body((Math.random()*100)+20);
            bodyList[i] = new Body("Body " + i, Math.round(Math.random()*(canvas.width/2)+(canvas.width/4)), Math.round(Math.random()*(canvas.height/2)+(canvas.height/4)), (Math.random()*1000), Math.random()*360, Math.random()*5);
        }
        



        function gameLoop() {

            //move(body);
            for (i=0; i<bodies; i++) {
                bodyList[i].move();

            }
            drawSun();
            ctx.strokeStyle = "#000000";
            for (i=0; i<bodies; i++) {
                bodyList[i].draw();

            }
            //console.log("GameLoop run")
            //gameLoop();
        }

        function getDistance(x1,y1,x2,y2) {
            //(Math.pow((x2-x1),2))+(Math.pow((y2-y1),2))
            d=Math.abs(Math.sqrt((Math.pow((x2-x1),2))+(Math.pow((y2-y1),2))));
            return d;
        }

        function calculatePull(a,b) {
            //a is the body
            //calculate vector
            d=getDistance(a.x,a.y,b.x,b.y);
            //G = 2.2 * 10^-5;
            G = 0.000022;
            //G = 9.81;
            f = G * ((a.mass * b.mass)/d);
            return f;
        }

        function calculatePull2(ax, ay ,bx , by, am, bm) {
            //a is the body
            //calculate vector
            d=getDistance(ax,ay,bx,by);
            //G = 2.2 * 10^-5;
            G = 0.000022;
            //G = 9.81;
            f = G * ((am * bm)/d);
            return f;
        }

        function getDirectionDeg(ax,ay,bx,by) {
            // angle in degrees
            angleDeg = Math.atan2(by - ay, bx - ax) * 180 / Math.PI;
            return angleDeg*-1;
        }

        function getDirectionRad(ax,ay,bx,by) {
            // angle in radians
            angleRad = Math.atan2(by - ay, bx - ax)
            return angleRad;
        }


        function lengthDirX(f,d) {
            angleRad = d*Math.PI/180;
            return f * Math.cos(angleRad);
        }

        function lengthDirY(f,d) {
            angleRad = d*Math.PI/180;
            return f * -Math.sin(angleRad);
        }

        function lengthDirXRad(f,d) {

            return f * Math.cos(d);
        }

        function lengthDirYRad(f,d) {

            return f * -Math.sin(d);
        }
        


        function drawSun(BodyList) {

            

        ctx.fillStyle = "white";
        ctx.fillRect( 0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "green";

        ctx.strokeStyle = "#000000";
        //ctx.beginPath();
        //ctx.arc(sun.x, sun.y, 50, 0, Math.PI * 2, true); // sun
        //ctx.stroke();

        ctx.font = "48px serif";
        ctx.fillText(`bodies: ${bodyList.length}`, 10, 50);
        ctx.fillText(`body 0 mass: ${bodyList[0].mass}`, 10, 100);
        /*
        ctx.fillText(`body y: ${body.y}`, 10, 100);
        ctx.fillText(`body vector x: ${body.vx}`, 10, 150);
        ctx.fillText(`body vector y: ${body.vy}`, 10, 200);
        f = calculatePull(body,sun);
        ctx.fillText(`force: ${f}`, 10, 250);
        dis = getDistance(body.x,body.y,sun.x,sun.y);
        ctx.fillText(`distance: ${dis}`, 10, 300);
        dir = getDirectionDeg(body.x,body.y,sun.x,sun.y);
        ctx.fillText(`direction to sun: ${dir}`, 10, 350);
        */
    }
        //ctx.beginPath();
        //ctx.arc(95, 50, 40, 0, 2 * Math.PI);
        //ctx.stroke();


        setInterval(gameLoop, 16);
    </script>
</body>
</html>